import{_ as G,r as u,i as b,c as d,g as m,b as r,e,t as n,l as g,z as te,F as Q,h as W,n as S,w as J,v as K,k as se,x as E,o as ae,A as q,P as ne}from"./index-BVhOrBYu.js";const oe={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},le={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},ie={class:"relative inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full sm:p-6"},re={class:"flex items-center justify-between mb-6"},de={class:"text-sm text-gray-500"},ue={class:"bg-gray-50 rounded-lg p-4 mb-6"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ge={class:"space-y-1 text-sm text-gray-600"},me={class:"space-y-1 text-sm"},pe={class:"mt-4"},ve={class:"flex justify-between text-sm text-gray-600 mb-1"},xe={class:"w-full bg-gray-200 rounded-full h-2"},fe={class:"space-y-4 max-h-96 overflow-y-auto"},he={class:"flex items-start justify-between"},be={class:"flex-1 min-w-0"},ye={class:"flex items-center space-x-2"},we={class:"text-sm font-medium text-gray-900 truncate"},ke={key:0,class:"text-xs text-gray-500 mt-1"},_e={key:1,class:"text-xs text-red-500 mt-1"},je={key:2,class:"text-xs text-gray-600 mt-2 bg-gray-100 p-2 rounded"},$e={class:"flex flex-col space-y-2 ml-4"},De=["onClick"],Ce={key:1,class:"flex space-x-1"},Me=["onClick","disabled"],Pe=["onClick","disabled"],ze={key:0,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-60"},Ae={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},Te={class:"text-lg font-medium text-gray-900 mb-4"},Be={class:"text-sm text-gray-600 mb-4"},Se={class:"space-y-3"},Ve={class:"block text-sm font-medium text-gray-700 mb-1"},Le={key:0,class:"text-red-500"},Ue={class:"relative"},Ie=["placeholder"],Re={key:0,class:"mt-1 text-xs text-red-500"},Ee={class:"flex space-x-2"},Ne=["disabled"],He=["disabled"],Oe={key:1,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-60"},Fe={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},Je={class:"text-sm text-gray-600 mb-4"},Ke={class:"space-y-3"},qe={class:"relative"},Ge={key:0,class:"mt-1 text-xs text-red-500"},Qe={class:"flex space-x-2"},We=["disabled"],Xe={class:"flex items-center justify-center"},Ye={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},Ze=["disabled"],et={key:2,class:"mt-4 p-3 bg-green-50 border border-green-200 rounded-md"},tt={class:"flex"},st={class:"text-sm text-green-800"},at={key:3,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md"},nt={class:"flex"},ot={class:"text-sm text-red-800"},lt={key:4,class:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md"},it={class:"mt-6 flex justify-between"},rt=["disabled"],dt={__name:"PengajuanActionModal",props:{pengajuan:{type:Object,required:!0}},emits:["close","documentUpdated","pengajuanRejected"],setup(y,{emit:A}){const c=y,z=A,x=u(new Set),$=u(new Map),w=u(!1),p=u(null),v=u(""),k=u(""),f=u(""),C=u(""),h=u(""),B=u(!1),_=u(!1),j=u(""),M=u(""),V=localStorage.getItem("token"),P=b(()=>c.pengajuan.Documents.length),T=b(()=>c.pengajuan.Documents.filter(a=>a.status==="approved").length),U=b(()=>c.pengajuan.Documents.filter(a=>a.status==="rejected").length),I=b(()=>c.pengajuan.Documents.filter(a=>a.status==="pending").length),l=b(()=>c.pengajuan.Documents.filter(a=>a.status==="menunggu_perbaikan").length),s=b(()=>T.value===P.value),i=a=>a.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),D=a=>{switch(a){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";case"menunggu_perbaikan":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},N=a=>{switch(a){case"approved":return"border-green-200 bg-green-50";case"rejected":return"border-red-200 bg-red-50";case"pending":return"border-yellow-200 bg-yellow-50";case"menunggu_perbaikan":return"border-blue-200 bg-blue-50";default:return"border-gray-200"}},R=a=>{switch(a){case"approved":return"Disetujui";case"rejected":return"Ditolak";case"pending":return"Pending";case"menunggu_perbaikan":return"Menunggu Perbaikan";default:return a}},X=a=>{window.open(a,"_blank")},H=(a,t)=>{p.value=a,v.value=t,k.value="",f.value="",w.value=!0},O=()=>{w.value=!1,p.value=null,v.value="",k.value="",f.value=""},Y=()=>{j.value="",M.value="",B.value=!0},F=()=>{B.value=!1,j.value="",M.value=""},Z=async()=>{if(!j.value.trim()){M.value="Alasan penolakan wajib diisi";return}try{_.value=!0,M.value="",h.value="";const a=c.pengajuan.id_pengajuan||c.pengajuan.id;if(!a)throw new Error("ID Pengajuan tidak ditemukan");const t=await E.put(`https://bitwisi.cloud/api/pengajuan/${a}/reject`,{admin_note:j.value.trim()},{headers:{Authorization:`Bearer ${V}`,"Content-Type":"application/json"},timeout:3e4});C.value=`Pengajuan ${c.pengajuan.kode_pengajuan} berhasil ditolak`,setTimeout(()=>{C.value=""},3e3),z("pengajuanRejected",t.data),F(),setTimeout(()=>{z("close")},2e3)}catch(a){console.error("Error rejecting pengajuan:",a);let t="";a.code==="ECONNABORTED"?t="Timeout: Server terlalu lama merespons":a.response?.status===404?t="Pengajuan tidak ditemukan":a.response?.status===403?t="Anda tidak memiliki hak akses untuk menolak pengajuan ini":a.response?.status===400?t=a.response.data?.message||"Pengajuan tidak dapat ditolak":t=`Gagal menolak pengajuan: ${a.response?.data?.message||a.message}`,h.value=t,setTimeout(()=>{h.value=""},5e3)}finally{_.value=!1}},ee=async()=>{if(!p.value){h.value="Tidak ada dokumen yang dipilih";return}const a=v.value==="rejected"?"rejected":v.value;if(a==="menunggu_perbaikan"&&!k.value.trim()){f.value="Alasan penolakan wajib diisi";return}try{if(x.value.add(p.value.id),$.value.set(p.value.id,v.value),f.value="",h.value="",(await E.put(`https://bitwisi.cloud/api/pengajuan/documents/${p.value.id}/status`,{status:a,admin_note:k.value.trim()||null},{headers:{Authorization:`Bearer ${V}`,"Content-Type":"application/json"}})).status===200){const o=c.pengajuan.Documents.findIndex(L=>L.id===p.value.id);o!==-1&&(c.pengajuan.Documents[o].status=a,c.pengajuan.Documents[o].admin_note=k.value.trim()),C.value=`Status dokumen berhasil diubah menjadi ${R(a)}!`,setTimeout(()=>{C.value=""},3e3),z("documentUpdated"),O()}}catch(t){console.error("Error updating document status:",t),h.value=t.response?.data?.message||`Gagal mengubah status dokumen menjadi ${R(a)}`,setTimeout(()=>{h.value=""},5e3)}finally{x.value.delete(p.value.id),$.value.delete(p.value.id)}};return(a,t)=>y.pengajuan?(r(),d("div",oe,[e("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t[0]||(t[0]=o=>a.$emit("close"))}),e("div",le,[t[30]||(t[30]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ie,[e("div",re,[e("div",null,[t[5]||(t[5]=e("h3",{class:"text-lg font-medium text-gray-900"},"Review Dokumen Pengajuan",-1)),e("p",de,n(y.pengajuan.kode_pengajuan),1)]),e("button",{onClick:t[1]||(t[1]=o=>a.$emit("close")),class:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},t[6]||(t[6]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",ue,[e("div",ce,[e("div",null,[t[10]||(t[10]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Info Pengajuan",-1)),e("div",ge,[e("p",null,[t[7]||(t[7]=e("span",{class:"font-medium"},"Jenis:",-1)),g(" "+n(y.pengajuan.JenisPengajuan.name),1)]),e("p",null,[t[8]||(t[8]=e("span",{class:"font-medium"},"Pemilik:",-1)),g(" "+n(y.pengajuan.Owner.nama),1)]),e("p",null,[t[9]||(t[9]=e("span",{class:"font-medium"},"Lokasi:",-1)),g(" "+n(y.pengajuan.Lahan.wilayah_kelurahan)+", "+n(y.pengajuan.Lahan.wilayah_kecamatan),1)])])]),e("div",null,[t[15]||(t[15]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Status Dokumen",-1)),e("div",me,[e("p",null,[t[11]||(t[11]=e("span",{class:"font-medium text-green-600"},"Disetujui:",-1)),g(" "+n(T.value)+"/"+n(P.value),1)]),e("p",null,[t[12]||(t[12]=e("span",{class:"font-medium text-red-600"},"Ditolak:",-1)),g(" "+n(U.value),1)]),e("p",null,[t[13]||(t[13]=e("span",{class:"font-medium text-blue-600"},"Menunggu Perbaikan:",-1)),g(" "+n(l.value),1)]),e("p",null,[t[14]||(t[14]=e("span",{class:"font-medium text-yellow-600"},"Pending:",-1)),g(" "+n(I.value),1)])])])]),e("div",pe,[e("div",ve,[t[16]||(t[16]=e("span",null,"Progress Approval",-1)),e("span",null,n(Math.round(T.value/P.value*100))+"%",1)]),e("div",xe,[e("div",{class:"bg-green-600 h-2 rounded-full transition-all duration-300",style:te({width:`${T.value/P.value*100}%`})},null,4)])])]),e("div",fe,[(r(!0),d(Q,null,W(y.pengajuan.Documents,o=>(r(),d("div",{key:o.id,class:S(["border rounded-lg p-4",N(o.status)])},[e("div",he,[e("div",be,[e("div",ye,[e("h4",we,n(i(o.document_type)),1),e("span",{class:S([D(o.status),"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"])},n(R(o.status)),3)]),o.file_url?(r(),d("p",ke,n(o.original_name||"Dokumen tersedia"),1)):(r(),d("p",_e,"Belum diunggah")),o.admin_note?(r(),d("p",je,[t[17]||(t[17]=e("span",{class:"font-medium"},"Catatan Admin:",-1)),g(" "+n(o.admin_note),1)])):m("",!0)]),e("div",$e,[o.file_url?(r(),d("button",{key:0,onClick:L=>X(o.file_url),class:"text-indigo-600 hover:text-indigo-900 text-sm px-2 py-1 border border-indigo-200 rounded hover:bg-indigo-50 transition-colors",title:"Lihat Dokumen"},t[18]||(t[18]=[e("svg",{class:"w-4 h-4 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),g(" Lihat ")]),8,De)):m("",!0),(o.status==="pending"||o.status==="menunggu_perbaikan")&&o.file_url?(r(),d("div",Ce,[e("button",{onClick:L=>H(o,"approved"),disabled:x.value.has(o.id),class:"px-2 py-1 text-xs font-medium text-white bg-green-600 rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},n(x.value.has(o.id)&&$.value.get(o.id)==="approved"?"Loading...":"Setujui"),9,Me),e("button",{onClick:L=>H(o,"rejected"),disabled:x.value.has(o.id),class:"px-2 py-1 text-xs font-medium text-red-700 bg-white border border-red-300 rounded hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},n(x.value.has(o.id)&&$.value.get(o.id)==="rejected"?"Loading...":"Tolak"),9,Pe)])):m("",!0)])])],2))),128))]),w.value?(r(),d("div",ze,[e("div",Ae,[e("h4",Te,n(v.value==="approved"?"Setujui Dokumen":"Tolak Dokumen"),1),e("p",Be,n(i(p.value?.document_type)),1),e("div",Se,[e("div",null,[e("label",Ve,[g(n(v.value==="approved"?"Catatan Admin (Opsional)":"Alasan Penolakan")+" ",1),v.value==="rejected"?(r(),d("span",Le,"*")):m("",!0)]),e("div",Ue,[J(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=o=>k.value=o),rows:"3",class:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm resize-both min-h-[75px] max-h-[300px]",placeholder:v.value==="approved"?"Tambahkan catatan...":"Jelaskan alasan penolakan...",style:{resize:"vertical"}},null,8,Ie),[[K,k.value]]),t[19]||(t[19]=e("div",{class:"absolute bottom-2 right-2 text-gray-400 pointer-events-none"},[e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M13 6l3 3-3 3M4 6l3 3-3 3"})])],-1))]),f.value?(r(),d("p",Re,n(f.value),1)):m("",!0)]),e("div",Ee,[e("button",{onClick:ee,disabled:x.value.has(p.value?.id)||v.value==="rejected"&&!k.value.trim(),class:S([v.value==="approved"?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white","flex-1 px-4 py-2 text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"])},n(x.value.has(p.value?.id)?"Memproses...":v.value==="approved"?"Konfirmasi Setujui":"Konfirmasi Tolak"),11,Ne),e("button",{onClick:O,disabled:x.value.has(p.value?.id),class:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 transition-colors"}," Batal ",8,He)])])])])):m("",!0),B.value?(r(),d("div",Oe,[e("div",Fe,[t[25]||(t[25]=e("h4",{class:"text-lg font-medium text-gray-900 mb-4"},"Tolak Pengajuan",-1)),e("p",Je,[t[20]||(t[20]=g(" Apakah Anda yakin ingin menolak pengajuan ")),e("strong",null,n(y.pengajuan.kode_pengajuan),1),t[21]||(t[21]=g("? "))]),e("div",Ke,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[g(" Alasan Penolakan "),e("span",{class:"text-red-500"},"*")],-1)),e("div",qe,[J(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>j.value=o),rows:"3",class:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 text-sm resize-both min-h-[75px] max-h-[300px]",placeholder:"Jelaskan alasan penolakan pengajuan...",style:{resize:"vertical"}},null,512),[[K,j.value]]),t[22]||(t[22]=e("div",{class:"absolute bottom-2 right-2 text-gray-400 pointer-events-none"},[e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M13 6l3 3-3 3M4 6l3 3-3 3"})])],-1))]),M.value?(r(),d("p",Ge,n(M.value),1)):m("",!0)]),e("div",Qe,[e("button",{onClick:Z,disabled:_.value||!j.value.trim(),class:"flex-1 px-4 py-2 text-sm font-medium bg-red-600 hover:bg-red-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[e("div",Xe,[_.value?(r(),d("svg",Ye,t[24]||(t[24]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):m("",!0),g(" "+n(_.value?"Menolak...":"Konfirmasi Tolak"),1)])],8,We),e("button",{onClick:F,disabled:_.value,class:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 transition-colors"}," Batal ",8,Ze)])])])])):m("",!0),C.value?(r(),d("div",et,[e("div",tt,[t[26]||(t[26]=e("svg",{class:"w-5 h-5 text-green-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),e("p",st,n(C.value),1)])])):m("",!0),h.value?(r(),d("div",at,[e("div",nt,[t[27]||(t[27]=e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("p",ot,n(h.value),1)])])):m("",!0),s.value?(r(),d("div",lt,t[28]||(t[28]=[se('<div class="flex" data-v-61d62660><svg class="w-5 h-5 text-blue-400 mr-2" fill="currentColor" viewBox="0 0 20 20" data-v-61d62660><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" data-v-61d62660></path></svg><div data-v-61d62660><p class="text-sm font-medium text-blue-800" data-v-61d62660>Pengajuan Lengkap!</p><p class="text-sm text-blue-700" data-v-61d62660> Semua dokumen telah disetujui. Pengajuan akan otomatis disetujui. </p></div></div>',1)]))):m("",!0),e("div",it,[e("button",{onClick:Y,disabled:_.value,class:"inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-red-700 bg-white border border-red-300 rounded-md hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[t[29]||(t[29]=e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),g(" "+n(_.value?"Menolak...":"Tolak Pengajuan"),1)],8,rt),e("button",{onClick:t[4]||(t[4]=o=>a.$emit("close")),type:"button",class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"}," Tutup ")])])])])):m("",!0)}},ut=G(dt,[["__scopeId","data-v-61d62660"]]),ct={class:"min-h-screen bg-gray-50 py-8"},gt={class:"w-full mx-auto px-4 sm:px-6 lg:px-8"},mt={key:0,class:"flex justify-center items-center py-12"},pt={key:1,class:"bg-red-50 border border-red-200 rounded-md p-4 mb-6"},vt={class:"flex"},xt={class:"ml-3"},ft={class:"mt-2 text-sm text-red-700"},ht={key:2,class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},bt={class:"bg-white overflow-hidden shadow rounded-lg"},yt={class:"p-5"},wt={class:"flex items-center"},kt={class:"ml-5 w-0 flex-1"},_t={class:"text-lg font-medium text-gray-900"},jt={class:"bg-white overflow-hidden shadow rounded-lg"},$t={class:"p-5"},Dt={class:"flex items-center"},Ct={class:"ml-5 w-0 flex-1"},Mt={class:"text-lg font-medium text-gray-900"},Pt={class:"bg-white overflow-hidden shadow rounded-lg"},zt={class:"p-5"},At={class:"flex items-center"},Tt={class:"ml-5 w-0 flex-1"},Bt={class:"text-lg font-medium text-gray-900"},St={class:"bg-white overflow-hidden shadow rounded-lg"},Vt={class:"p-5"},Lt={class:"flex items-center"},Ut={class:"ml-5 w-0 flex-1"},It={class:"text-lg font-medium text-gray-900"},Rt={key:3,class:"bg-white shadow overflow-hidden sm:rounded-md"},Et={key:0},Nt={class:"overflow-x-auto"},Ht={class:"min-w-full divide-y divide-gray-200"},Ot={class:"bg-white divide-y divide-gray-200"},Ft={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Jt={key:0,class:"ml-1 text-red-500",title:"Menunggu lebih dari 7 hari"},Kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Qt={class:"px-6 py-4 whitespace-nowrap"},Wt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Xt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Yt={class:"flex space-x-2"},Zt=["onClick"],es=["onClick"],ts={key:1,class:"text-center py-12"},ss={__name:"DocumentApprovalPreview",setup(y){const A=u(!0),c=u(null),z=u([]),x=u(!1),$=u(!1),w=u(null),p=localStorage.getItem("token"),v=l=>{console.log("Opening action modal for:",l.kode_pengajuan),w.value=l,$.value=!0,console.log("showActionModal value:",$.value)},k=()=>{console.log("Closing action modal"),$.value=!1,w.value=null},f=b(()=>{const l=[];return z.value.forEach(s=>{if(s.pengajuan&&Array.isArray(s.pengajuan)){const i=s.pengajuan.filter(D=>D.status==="pending"||D.status==="rejected"||D.status==="menunggu_perbaikan");l.push(...i)}}),l.sort((s,i)=>new Date(s.createdAt)-new Date(i.createdAt))}),C=b(()=>f.value.filter(l=>l.status==="pending").length),h=b(()=>new Set(f.value.map(s=>s.user_id)).size),B=b(()=>f.value.reduce((l,s)=>l+(s.Documents?s.Documents.length:0),0)),_=b(()=>f.value.filter(l=>l.status==="pending"&&P(l.createdAt)).length),j=async()=>{try{A.value=!0,c.value=null;const l=await E.get("https://bitwisi.cloud/api/pengajuan",{headers:{Authorization:`Bearer ${p}`}});z.value=l.data}catch(l){c.value=`Failed to fetch data: ${l.response?.data?.message||l.message}`,console.error("Error fetching pengajuan data:",l)}finally{A.value=!1}},M=l=>{const s=z.value.find(i=>i.id===l);return s?s.username:"Unknown"},V=l=>new Date(l).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}),P=l=>{const s=new Date,i=new Date(l),D=Math.abs(s-i);return Math.ceil(D/(1e3*60*60*24))>7},T=l=>{w.value=l,x.value=!0},U=()=>{x.value=!1,w.value=null},I=()=>{j()};return ae(()=>{j()}),(l,s)=>(r(),d("div",ct,[e("div",gt,[A.value?(r(),d("div",mt,s[0]||(s[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600"},null,-1)]))):c.value?(r(),d("div",pt,[e("div",vt,[e("div",xt,[s[1]||(s[1]=e("h3",{class:"text-sm font-medium text-red-800"},"Error",-1)),e("div",ft,n(c.value),1)])])])):(r(),d("div",ht,[e("div",bt,[e("div",yt,[e("div",wt,[s[3]||(s[3]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"})])])],-1)),e("div",kt,[e("dl",null,[s[2]||(s[2]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Pending",-1)),e("dd",_t,n(C.value),1)])])])])]),e("div",jt,[e("div",$t,[e("div",Dt,[s[5]||(s[5]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})])])],-1)),e("div",Ct,[e("dl",null,[s[4]||(s[4]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Users",-1)),e("dd",Mt,n(h.value),1)])])])])]),e("div",Pt,[e("div",zt,[e("div",At,[s[7]||(s[7]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z","clip-rule":"evenodd"})])])],-1)),e("div",Tt,[e("dl",null,[s[6]||(s[6]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Dokumen",-1)),e("dd",Bt,n(B.value),1)])])])])]),e("div",St,[e("div",Vt,[e("div",Lt,[s[9]||(s[9]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])])],-1)),e("div",Ut,[e("dl",null,[s[8]||(s[8]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Perlu Tindakan",-1)),e("dd",It,n(_.value),1)])])])])])])),!A.value&&!c.value?(r(),d("div",Rt,[f.value.length>0?(r(),d("div",Et,[e("div",Nt,[e("table",Ht,[s[13]||(s[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Kode Pengajuan "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Jenis Pengajuan "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nama Pemilik "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," User "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tanggal Dibuat "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Aksi ")])],-1)),e("tbody",Ot,[(r(!0),d(Q,null,W(f.value,i=>(r(),d("tr",{key:i.kode_pengajuan,class:S(["hover:bg-gray-50",{"bg-red-50":P(i.createdAt)&&i.status==="pending","bg-red-100":i.status==="rejected"}])},[e("td",Ft,[g(n(i.kode_pengajuan)+" ",1),P(i.createdAt)&&i.status==="pending"?(r(),d("span",Jt," ⚠️ ")):m("",!0)]),e("td",Kt,n(i.JenisPengajuan.name),1),e("td",qt,n(i.Owner.nama),1),e("td",Gt,n(M(i.user_id)),1),e("td",Qt,[e("span",{class:S(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-yellow-100 text-yellow-800":i.status==="pending","bg-red-100 text-red-800":i.status==="rejected","bg-blue-100 text-blue-800":i.status==="menunggu_perbaikan"}])},[s[10]||(s[10]=e("svg",{class:"w-2 h-2 mr-1 fill-current",viewBox:"0 0 8 8"},[e("circle",{cx:"4",cy:"4",r:"3"})],-1)),g(" "+n(i.status==="pending"?"Pending":i.status==="rejected"?"Ditolak":"Menunggu Perbaikan"),1)],2)]),e("td",Wt,n(V(i.createdAt)),1),e("td",Xt,[e("div",Yt,[e("button",{onClick:D=>T(i),class:"text-indigo-600 hover:text-indigo-900 transition-colors duration-200",title:"Lihat Detail"},s[11]||(s[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)]),8,Zt),e("button",{onClick:D=>v(i),class:"text-green-600 hover:text-green-900 transition-colors duration-200",title:"Review Dokumen"},s[12]||(s[12]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)]),8,es)])])],2))),128))])])])])):(r(),d("div",ts,s[14]||(s[14]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900"}," Tidak ada pengajuan yang perlu ditinjau ",-1),e("p",{class:"mt-1 text-sm text-gray-500"},"Semua pengajuan telah diproses atau disetujui.",-1)])))])):m("",!0),x.value?(r(),q(ne,{key:4,pengajuan:w.value,isPending:!0,onClose:U},null,8,["pengajuan"])):m("",!0),$.value?(r(),q(ut,{key:5,pengajuan:w.value,onClose:k,onDocumentUpdated:I},null,8,["pengajuan"])):m("",!0)])]))}},ns=G(ss,[["__scopeId","data-v-fe63874d"]]);export{ns as default};
